<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

        <title>Hands-on Bluetooth Low Energy Workshop</title>

        <meta name="description" content="Hands-on Bluetooth Low Energy Workshop">
        <meta name="author" content="Don Coleman">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<!-- <link rel="stylesheet" href="css/theme/black.css" id="theme"> -->
        <link rel="stylesheet" href="css/theme/sky.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

        <!-- hack the style a bit -->
        <style>

            .reveal pre {
                font-size: 1em;
                width: 100%;
            }

            .reveal h1,
            .reveal h2,
            .reveal h3,
            .reveal h4,
            .reveal h5,
            .reveal h6 {
                text-transform: none;
            }

            .reveal section img {
                border: none;
            }

            .reveal ul {
                list-style-type: none
            }

        </style>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

            <section>
                <h2 style="margin-top:-30px;">Hands-on</h2>
                <h2 style="margin-top:-30px;">Bluetooth Low Energy</h2>
                <h2 style="margin-top:-30px;">Workshop</h2>
                <p>PhoneGap Day - October 12, 2017</p>
                <p>Don Coleman <a href="http://twitter.com/doncoleman">@doncoleman</a></p>
            </section>

            <section>
                <h2>Setup</h2>
                <a href="http://bit.ly/pdg-setup17">http://bit.ly/pdg-setup17</a>
            </section>
      
            <section>
              <img src="images/bluetooth.png">
            </section>

            <section>
              <!-- based on - Figure 3.1 from “Bluetooth Low Energy” by Robin Heydon -->
              <img width="60%" src="images/architecture.svg">
            </section>

            <section>
              <h2>Lightbulb Service</h2>
                <ul>
                  <li>Light Switch</li>
                  <li>Dimmer Setting</li>
                </ul>
            </section>

            <section>
              <h2>Lightbulb Service - FF10</h2>
              <img src="images/uuid.png" />
            </section>

            <section>
              <h2>16 bit UUIDs</h2>
              <p style="color:#888">0000<span style="color:#000"><b>FF10</b></span>-0000-1000-8000-00805F9B34FB</p>
              <p style="color:#888">0000<span style="color:#000"><b>FF11</b></span>-0000-1000-8000-00805F9B34FB</p>
              <p style="color:#888">0000<span style="color:#000"><b>FF12</b></span>-0000-1000-8000-00805F9B34FB</p>
            </section>

            <section>
              <h2>Lightbulb Service - FF10</h2>
              <img src="images/lightbulb-service.png" />
            </section>

            <!--
            <section>
                <h2>GAP</h2>
                <h2>Generic Access Profile</h2>
            </section>
            -->

            <section>
              <h2>Advertising</h2>
              <img width="50%" src="images/advertise.svg" />
            </section>

            <section>
              <h2>Advertising</h2>
              <ul>
                <li>5425B44A-024A-4D39-88D2-D9F016199B29</li>
                <li>Services: [ 0x180A, 0xFF10, 0XFF20, …] </li>
                <li>Manufacturer Data: <00007465 6d70></li>
                <li>Connectable: True</li>
                <li>TX Power Level: 4</li>
                <li>RSSI: -80</li>
                <li>Name: LED</li>
              </ul>
            </section>

            <section>
                <img width="100%" src="images/ble_advertisement.png" />
            </section>

            <section>
                <img width="100%" src="images/ble_connection.png" />
            </section>

            <section>
              <img src="images/lightblue-discover.png" />
            </section>

            <section>
              <h2>Connect</h2>
              <img width="80%" src="images/connect.svg" />
            </section>

            <section>
              <img src="images/lightblue.png" />
            </section>

            <!-- attribute protocol -->

           <section>
              <h2>Read Value</h2>
              <img width="80%" src="images/read.svg">
            </section>

            <section>
              <h2>Write Value</h2>
              <img width="80%" src="images/write.svg">
            </section>

            <!-- <section>
              <h2>Write Command</h2>
              <img width="80%" src="images/command.svg">
            </section> -->

            <section>
              <h2>Notification</h2>
              <img width="80%" src="images/notification.svg">
            </section>

            <!-- <section>
              <h2>Indication</h2>
              <img width="80%" src="images/indication.svg">
            </section> -->

            <section>
              <h2>Peripheral</h2>
              <p>Provides services</p>
            </section>

            <section>
              <h2>Central</h2>
              <ul>
                <li>Discover advertising peripherals</li>
                <li>Connect using MAC Address or UUID</li>
                <li>Explore the services and characteristics</li>
                <li>Read and write characteristics</li>
                <li>Subscribe to be notified of changes</li>
              </ul>
            </section>

            <section>
                <h3>Bluetooth Low Energy</h3>
                <h3>Cordova Plugin</h3>
                 <a href="https://github.com/don/cordova-plugin-ble-central">https://github.com/don/cordova-plugin-ble-central</a>
            </section>

            <section>
                <img src="images/phonegap-developer-app.png">
            </section>

            <section>
                <h3>CC2650 SensorTag</h3>
                <img src="images/TI_SensorTag.jpg" width="80%">
            </section>

            <!-- probably remove this one -->
            <section>
                <h3>CC2650 Sensors &amp; Services</h3>
                <ul>
                    <li>IR &amp; Ambient Temperature Sensor</li>
                    <li>Ambient Light Sensor</li>
                    <li>Humidity Sensor</li>
                    <li>Barometric Pressure Sensor</li>
                    <li>9-axis Motion Tracking</li>
                    <li>Magnet Sensor</li>
                    <li>OTA Download</li>
                </ul>
                <p>
                    <small><a href="http://bit.ly/sensortag-guide">http://bit.ly/sensortag-guide</a></small>
                </p>
            </section>

            <section>
                <h2>Today we'll build apps to</h2>
                <ul>
                    <li class="fragment">Scan for peripherals</li>
                    <li class="fragment">Connect to peripheral</li>
                    <li class="fragment">Respond to button input</li>
                    <li class="fragment">Control a LED</li>
                    <li class="fragment">Read temperature sensors</li>
                </ul>
            </section>

            <section>
                <p>Exercise 1</p>
                <h1>Scan</h1>
            </section>

            <section>
                <img src="images/ios-scan.png" width="70%">
            </section>

            <section>
                <img src="images/ios-android-scan.png" width="70%">
            </section>

            <section>
                <h2>Create Project</h2>
                <pre><code class="sh">
    cordova create \
    scan com.example.scan Scan \
    --template bluetooth-workshop-template
                </code></pre>
            </section>
    
            <section>
                <pre><code class="javascript">
    ble.scan(
        [], // any services
        5,  // 5 seconds
        onDiscoverDevice,
        failure
    );
                </code></pre>
            </section>

            <section>
                <pre><code class="javascript">
  var onDiscoverDevice = function(device) {
      console.log(
          device.name,
          device.id,
          device.rssi
      );
  }
                </code></pre>
            </section>

            <section>
                <p>https://github.com/don/phonegap-ble-workshop</p>
            </section>
    
            <section>
                <p>Exercise 2</p>
                <h1>Connect</h1>
            </section>

            <!-- <section>
                <img src="images/ios-connect.png" width="70%">
            </section> -->

            <section>
                <img src="images/android-connect.png" width="70%">
            </section>

            <section>
                <pre><code class="javascript">
    ble.connect(
        device.id,
        onConnection,
        failure
    );
                </code></pre>
            </section>

            <section>
                <pre><code class="javascript">
  var onConnection = function(peripheral) {
      console.log(
          JSON.stringify(peripheral)
      );
  }
                </code></pre>
            </section>
    
            <section>
                <p>Exercise 3</p>
                <h1>Button</h1>
            </section>

            <section>
                <img src="images/sensortag-buttons.png" width="70%">
            </section>

            <section>
                <h2>Button Service - FFE0</h2>
                <img src="images/simple-key-service.png">
                <p>
                    <small>
                        <a href="http://bit.ly/sensortag-button">http://bit.ly/sensortag-button</a>
                    </small>
                </p>
            </section>

            <section>
                <img src="images/ios-button.png" width="70%">
            </section>

            <section>
                <pre><code class="javascript">
    ble.startNotification(
        device.id,
        BUTTON_SERVICE,
        DATA_CHARACTERISTIC,
        onNotification,
        failure);
                </code></pre>
            </section>

            <section>
                <pre><code class="javascript">
  var onNotification = function(buffer) {
      var data = new Uint8Array(buffer);
      if (data[0] === 0) {
          message = 'Button is released.';
      } else {
          message = 'Button is pressed.';
      }
  }
                </code></pre>
            </section>

            <section>
				<h2>Button Bitmask</h2>
				<table>
					<thead>
						<tr>
							<th>Button</th>
							<th>Integer</th>
							<th>Bits</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>Left Button</td>
							<td style="text-align: center">1</td>
							<td>0001</td>
						</tr>
						<tr>
							<td>Right Button</td>
							<td style="text-align: center">2</td>
							<td>0010</td>
						</tr>
						<tr>
							<td>Reed Switch</td>
							<td style="text-align: center">4</td>
							<td>0100</td>
						</tr>
					</tbody>
				</table>
			</section>

            <section>
                <!-- in onNotification -->
                    <pre><code class="javascript">  if (state &amp; LEFT_BUTTON) {
    message += 'Left button is pressed.';
  }
  if (state &amp; RIGHT_BUTTON) {
    message += 'Right button is pressed.';
  }
  if (state &amp; REED_SWITCH) {
    message += 'Reed switch is activated.';
  }
                </code></pre>
                <small>Decode button from bitmask in app.onNotification()</small>
            </section>

            <section>
                <img src="images/ios-button_v2.png" width="70%">
            </section>

            <section>
                <p>Exercise 4</p>
                <h1>LED</h1>
            </section>

            <section>
                <img src="images/sensortag-led.png" width="70%">
            </section>

            <section>
                <h2>IO Service</h2>
                <p>f000<b>AA64</b>-0451-4000-b000-000000000000</p>
                <img src="images/io-service.png">
                <p>
                    <small>
                        <a href="http://bit.ly/sensortag-led">http://bit.ly/sensortag-led</a>
                    </small>
                </p>
            </section>

            <section>
                <img src="images/ios-led.png" width="70%">
            </section>

            <section>
                <pre><code class="javascript">
    ble.write(
        device.id,
        service,
        characteristic,
        data,
        success,
        failure);
                </code></pre>
            </section>

            <section>
                <pre><code class="javascript">
  ble.write(
    app.peripheral.id,
    IO_SERVICE,
    CONFIGURATION_CHARACTERISTIC,
    new Uint8Array([1]).buffer,
    app.showDetailPage,
    app.onError
  );
                </code></pre>
                <small>Enable IO Service in app.onConnect()</small>
            </section>

            <section>
                <pre><code class="javascript">
  ble.write(
    app.peripheral.id,
    IO_SERVICE,
    DATA_CHARACTERISTIC,
    data.buffer,
    success,
    app.onError
  );
                </code></pre>
                <small>Write value to data characteristic in app.setDataValue(int)</small>
            </section>

            <section>
                <h2>IO Bitmask</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Device</th>
                            <th>Integer</th>
                            <th>Bits</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Red LED</td>
                            <td style="text-align: center">1</td>
                            <td>0001</td>
                        </tr>
                        <tr>
                            <td>Green LED</td>
                            <td style="text-align: center">2</td>
                            <td>0010</td>
                        </tr>
                        <tr>
                            <td>Buzzer</td>
                            <td style="text-align: center">4</td>
                            <td>0100</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section>
                <!-- in optionsChanged -->
                <pre><code class="javascript">  var data = 0;
  if (redCheckbox.checked) {
    data = data | RED_LED;
  }
  if (greenCheckbox.checked) {
    data = data | GREEN_LED;
  }
  if (buzzerCheckbox.checked) {
    data = data | BUZZER;
  }
  app.setDataValue(data);
                </code></pre>
                <small>Encode data with bitmask in app.optionsChanged()</small>
            </section>

            <section>
                <img src="images/ios-led_v2.png" width="70%">
            </section>

            <section>
                <p>Exercise 5</p>
                <h1>Thermometer</h1>
            </section>

            <section>
                <img src="images/sensortag-temperature.png">
            </section>

            <section>
                <h2>Temperature Service</h2>
                <p>f000<b>AA00</b>-0451-4000-b000-000000000000</p>
                <img src="images/temperature-service.png">
                <p>
                    <small>
                        <a href="http://bit.ly/sensortag-temp">http://bit.ly/sensortag-temp</a>
                    </small>
                </a>
            </section>

            <section>
                <img src="images/ios-thermometer.png" width="70%">
            </section>

            <section>
                <img src="images/MakeBluetooth.jpg" width="50%"><br/>
                <a href="http://bit.ly/bluetooth-book">http://bit.ly/bluetooth-book</a>
            </section>

            <section>
                <h2>Thank You</h2>
                <p>Don Coleman <a href="http://twitter.com/doncoleman">@doncoleman</a></p>

                <p>
                <a href="http://don.github.io/slides/">
                    http://don.github.io/slides/</a>
                </p>
                <p>
                    <a href="http://chariotsolutions.com/">chariotsolutions.com</a>
                </p>
                <!-- should be using css -->
                <p>&nbsp;</p>
                <p>&nbsp;</p>
                <p>
                    <small>
                        <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Hands-on Bluetooth Low Energy Workshop</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://don.github.io/slides/2017-10-12-phonegap-day" property="cc:attributionName" rel="cc:attributionURL">Don Coleman</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
                    </small>
                </p>
            </section>

			</div> <!-- end slides -->

		</div>  <!-- end reveal -->

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
